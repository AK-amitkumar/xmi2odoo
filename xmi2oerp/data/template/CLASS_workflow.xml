<?xml version="1.0" encoding="utf-8"?>
<!--
${LICENSE_HEADER}\
-->
{% def model(s='.') %}${CLASS_MODULE}${s}${CLASS_NAME}{% end %}\
<openerp>
    <data>
        <!-- Workflow -->

        <record id="${model()}.wkf" model="workflow">
            <field name="name">${model()}.basic</field>
            <field name="osv">${model()}</field>
            <field name="on_create">True</field>
        </record>

        <!-- Activities -->

        <record id="act_${CLASS_WORKFLOW_START_STATE}" model="workflow.activity">
            <field name="wkf_id" ref="${model()}.wkf"/>
            <field name="flow_start">True</field>
            <field name="name">${CLASS_WORKFLOW_START_STATE}</field>
        </record>

{% for act in CLASS_WORKFLOW_NOSTART_STATES %}\
        <record id="act_${act.name}" model="workflow.activity">
            <field name="wkf_id" ref="${model()}.wkf"/>
            <field name="name">draft</field>
{%  if act.stop_flow %}\
            <field name="flow_stop">True</field>
{%  end %}\
{%  if 'action' in act.tag %}\
            <field name="action">${act.tag['action']}</field>
{%  end %}\
{%  if 'action' not in act.tag %}\
            <field name="action">write({'state':'${act.name}'})</field>
{%  end %}\
            <field name="kind">function</field>
        </record>
{% end %}\

        <!-- Transitions -->

{% for tran in CLASS_WORKFLOW_TRANSITIONS %}\
        <record id="t4" model="workflow.transition">
            <field name="act_from" ref="act_${tran.source.name}"/>
            <field name="act_to" ref="act_${tran.target.name}"/>
            <field name="signal">invoice_open</field>
        </record>
{% end %}\

        <record id="t8" model="workflow.transition">
            <field name="act_from" ref="act_open"/>
            <field name="act_to" ref="act_paid"/>
            <field name="trigger_model">account.move.line</field>
            <field name="trigger_expr_id">move_line_id_payment_get()</field>
            <field name="condition">test_paid()</field>
        </record>
        <record id="t9" model="workflow.transition">
            <field name="act_from" ref="act_draft"/>
            <field name="act_to" ref="act_cancel"/>
            <field name="signal">invoice_cancel</field>
        </record>
        <record id="t12" model="workflow.transition">
            <field name="act_from" ref="act_open"/>
            <field name="act_to" ref="act_cancel"/>
            <field name="signal">invoice_cancel</field>
        </record>
        <record id="t13" model="workflow.transition">
            <field name="act_from" ref="act_paid"/>
            <field name="act_to" ref="act_open_test"/>
            <field name="signal">open_test</field>
        </record>
        <record id="t14" model="workflow.transition">
            <field name="act_from" ref="act_open_test"/>
            <field name="act_to" ref="act_cancel"/>
            <field name="signal">invoice_cancel</field>
        </record>

        <record id="open_test_to_paid" model="workflow.transition">
            <field name="act_from" ref="act_open_test"/>
            <field name="act_to" ref="act_paid"/>
            <field name="trigger_model">account.move.line</field>
            <field name="trigger_expr_id">move_line_id_payment_get()</field>
            <field name="condition">test_paid()</field>
        </record>

        <record id="draft_to_pro2" model="workflow.transition">
            <field name="act_from" ref="account.act_draft"/>
            <field name="act_to" ref="act_proforma2"/>
            <field name="signal">invoice_proforma2</field>
        </record>

        <record id="pro2_to_open" model="workflow.transition">
            <field name="act_from" ref="act_proforma2"/>
            <field name="act_to" ref="account.act_open"/>
            <field name="signal">invoice_open</field>
        </record>

        <record id="pro2_to_cancel" model="workflow.transition">
            <field name="act_from" ref="act_proforma2"/>
            <field name="act_to" ref="account.act_cancel"/>
            <field name="signal">invoice_cancel</field>
        </record>
    </data>
</openerp>
<!-- vim:expandtab:smartindent:tabstop=4:softtabstop=4:shiftwidth=4
     -->
